<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>H–I Vizsgaszimulátor (EU 2024/573)</title>
<style>
  :root {
    --bg: #0f172a;
    --card: #111827;
    --muted: #94a3b8;
    --text: #e5e7eb;
    --accent: #22c55e;
    --danger: #ef4444;
    --brand: #38bdf8;
  }
  * { box-sizing: border-box; }
  body {
    margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    background: linear-gradient(180deg, #0b1220 0%, #0f172a 100%);
    color: var(--text);
  }
  .container { max-width: 980px; margin: 0 auto; padding: 24px 16px 48px; }
  .card {
    background: rgba(17,24,39,.85); backdrop-filter: blur(8px);
    border: 1px solid rgba(148,163,184,.15);
    border-radius: 16px; padding: 24px; margin-top: 16px;
    box-shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  h1 { font-size: 28px; margin: 12px 0 4px; }
  .muted { color: var(--muted); }
  .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
  button {
    border: 1px solid rgba(148,163,184,.25);
    background: linear-gradient(180deg, #111827 0%, #0b1220 100%);
    color: var(--text);
    padding: 10px 16px; border-radius: 10px; cursor: pointer;
    transition: .2s ease; font-weight: 600;
  }
  button.primary { border-color: rgba(56,189,248,.5); color: white; }
  button.primary:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(56,189,248,.2); }
  .pill { padding: 6px 10px; border-radius: 999px; border: 1px solid rgba(148,163,184,.25); }
  .grid { display: grid; gap: 16px; }
  .answer {
    border: 1px solid rgba(148,163,184,.25); border-radius: 12px; padding: 10px 12px;
    display: flex; gap: 10px; align-items: start; cursor: pointer;
  }
  .answer input { margin-top: 4px; }
  .question-block { border: 1px solid rgba(148,163,184,.15); border-radius: 14px; padding: 16px; }
  .qhead { display:flex; justify-content: space-between; align-items: center; gap: 10px; margin-bottom: 10px; }
  .timer { font-variant-numeric: tabular-nums; font-weight: 700; }
  .ok { color: var(--accent); font-weight: 700; }
  .bad { color: var(--danger); font-weight: 700; }
  details summary { cursor: pointer; }
  .footer-note { margin-top: 8px; font-size: 12px; color: var(--muted); }
</style>
</head>
<body>
  <div class="container">
    <div class="card" id="intro">
      <h1>H–I vizsgafelkészítő teszt (EU 2024/573)</h1>
      <p class="muted">40 kérdés • 40 perc • Minimum 51% a sikerhez • Minden indításnál új, véletlenszerű kérdéssor</p>
      <ul>
        <li>A kérdések a teljes kérdésbankból kerülnek véletlenszerűen kiválasztásra.</li>
        <li>Csak egy helyes válasz van (A/B/C).</li>
        <li>A végén részletes eredményt kapsz, hibáknál megjelenik a helyes válasz és a megjegyzés.</li>
      </ul>
      <div class="row">
        <label class="pill">Kérdések száma: <input id="qCount" type="number" min="5" max="120" value="40" style="width:68px;margin-left:8px;background:#0b1220;color:#e5e7eb;border:1px solid rgba(148,163,184,.35);border-radius:8px;padding:4px 6px;"></label>
        <label class="pill">Időkeret (perc): <input id="qMinutes" type="number" min="5" max="120" value="40" style="width:68px;margin-left:8px;background:#0b1220;color:#e5e7eb;border:1px solid rgba(148,163,184,.35);border-radius:8px;padding:4px 6px;"></label>
        <button class="primary" onclick="startQuiz()">Teszt indítása</button>
      </div>
      <div class="footer-note">Tipp: indítsd el többször — minden alkalommal más feladatsor jön.</div>
    </div>

    <div class="card" id="exam" style="display:none;">
      <div class="qhead">
        <div><strong id="examTitle">H–I próbavizsga</strong> • <span id="progress">0/0</span></div>
        <div>Idő: <span class="timer" id="timer">40:00</span></div>
      </div>
      <form id="quizForm" class="grid"></form>
      <div class="row" style="justify-content: space-between; margin-top: 8px;">
        <div class="muted">Kérdés- és válaszsorrend véletlenszerűsítve</div>
        <div class="row">
          <button type="button" onclick="submitQuiz()" class="primary">Leadás</button>
          <button type="button" onclick="cancelQuiz()">Mégse</button>
        </div>
      </div>
    </div>

    <div class="card" id="result" style="display:none;">
      <h2>Eredmény</h2>
      <p><strong>Pontszám:</strong> <span id="score"></span></p>
      <p><strong>Státusz:</strong> <span id="status"></span></p>
      <details>
        <summary>Hibák és megoldások megtekintése</summary>
        <div id="review" class="grid" style="margin-top:12px;"></div>
      </details>
      <div class="row" style="margin-top:12px;">
        <button class="primary" onclick="restart()">Új teszt indítása</button>
        <button onclick="window.print()">Nyomtatás / Mentés PDF-be</button>
      </div>
    </div>
  </div>

<script>
  const ALL_QUESTIONS = [];

  let picked = [];
  let answersGiven = {};
  let timerId = null;
  let endAt = 0;

  function shuffle(a) {
    for (let i=a.length-1; i>0; i--) {
      const j = Math.floor(Math.random()*(i+1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function startQuiz() {
    const totalAvailable = ALL_QUESTIONS.length;
    const reqCount = parseInt(document.getElementById('qCount').value || '40', 10);
    const qCount = Math.max(5, Math.min(reqCount, totalAvailable));
    const mins = Math.max(5, Math.min(parseInt(document.getElementById('qMinutes').value || '40', 10), 120));

    picked = shuffle([...ALL_QUESTIONS]).slice(0, qCount).map((q, idx) => ({...q, idx}));
    answersGiven = {};

    document.getElementById('intro').style.display = 'none';
    document.getElementById('exam').style.display = 'block';
    document.getElementById('result').style.display = 'none';
    document.getElementById('progress').textContent = `0/${picked.length}`;

    const form = document.getElementById('quizForm');
    form.innerHTML = '';
    picked.forEach((q, i) => {
      const letters = ['A','B','C'];
      const options = letters.map((L, k) => ({L, text: q.answers[k]}));
      shuffle(options);

      const block = document.createElement('div');
      block.className = 'question-block';
      block.innerHTML = `
        <div class="qhead"><div><strong>${i+1}.</strong> ${q.question}</div>
        <div class="pill">${q.category || 'Általános'}</div></div>
        <div class="grid" id="opts-${i}"></div>
      `;
      form.appendChild(block);
      const opts = block.querySelector('#opts-'+i);
      options.forEach(opt => {
        const id = `q${i}_${opt.L}`;
        const row = document.createElement('label');
        row.className = 'answer';
        row.innerHTML = `
          <input type="radio" name="q${i}" value="${opt.L}" id="${id}">
          <div><strong>${opt.L})</strong> ${opt.text}</div>
        `;
        opts.appendChild(row);
      });
    });

    // Timer
    const total = mins*60*1000;
    endAt = Date.now() + total;
    const timerEl = document.getElementById('timer');
    clearInterval(timerId);
    timerId = setInterval(() => {
      const left = Math.max(0, endAt - Date.now());
      const mm = String(Math.floor(left/60000)).padStart(2,'0');
      const ss = String(Math.floor((left%60000)/1000)).padStart(2,'0');
      timerEl.textContent = `${mm}:${ss}`;
      if (left <= 0) {
        clearInterval(timerId);
        submitQuiz();
      }
    }, 250);
  }

  function submitQuiz() {
    let correct = 0;
    const review = [];
    const form = document.getElementById('quizForm');
    picked.forEach((q, i) => {
      const checked = form.querySelector(`input[name="q${i}"]:checked`);
      const user = checked ? checked.value : null;
      const isCorrect = user === q.correct;
      if (isCorrect) correct += (q.points||1);
      review.push({i, q, user, isCorrect});
    });

    const totalPoints = picked.reduce((s,q)=>s+(q.points||1),0);
    const percent = Math.round((correct/totalPoints)*100);
    const pass = percent >= 51;

    document.getElementById('exam').style.display = 'none';
    document.getElementById('result').style.display = 'block';
    document.getElementById('score').textContent = `${correct} / ${totalPoints} pont (${percent}%)`;
    document.getElementById('status').innerHTML = pass ? '<span class="ok">Sikeres ✅</span>' : '<span class="bad">Nem sikeres ❌</span>';

    const rev = document.getElementById('review');
    rev.innerHTML = '';
    review.forEach(r => {
      if (r.isCorrect) return;
      const letters = ['A','B','C'];
      const correctText = letters.includes(r.q.correct) ? r.q.answers[letters.indexOf(r.q.correct)] : '';
      const div = document.createElement('div');
      div.className = 'question-block';
      div.innerHTML = `
        <div class="qhead"><div><strong>${r.i+1}.</strong> ${r.q.question}</div><div class="pill">${r.q.category||''}</div></div>
        <div class="muted">Válaszod: <strong>${r.user||'—'}</strong> • Helyes: <strong>${r.q.correct}</strong></div>
        <div class="muted">Helyes válasz szövege: <em>${correctText}</em></div>
        ${r.q.feedback ? `<div style="margin-top:6px;">Megjegyzés: ${r.q.feedback}</div>` : ''}
      `;
      rev.appendChild(div);
    });
  }

  function cancelQuiz() {
    clearInterval(timerId);
    document.getElementById('intro').style.display = 'block';
    document.getElementById('exam').style.display = 'none';
    document.getElementById('result').style.display = 'none';
  }

  function restart() { cancelQuiz(); }
</script>
</body>
</html>
